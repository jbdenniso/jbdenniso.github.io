---
title: 'Automatic Apnea Detection with Bayesian Switch Point Analysis'
date: 2024-06-17
permalink: /posts/Apnea_Detection/
tags:
  - Bayesian Modeling
  - CMRO2
  - MRI
---


 Problem: 
-----------------------

We have 90 minutes of metabolic data from a sleeping patient with obstructive sleep apnea. Due to simultaneous EEG and airway pressure recordings we have information about the patients sleep status (Awake, Stage 1, Stage 2, or Stage 3 of sleep) and breathing events (apneas and hypopneas). We want to measure how much if any oxygen metabolism changes in the brain (CMRO2) in response to an apneac event.

![Time course of patient sleep]({{ site.baseurl }}/images/post1/All_Metabolic.png)

Here you can see that over the whole 90 minutes the patient has one apnea lasting approximately 90 seconds. However, we don't know if there will be a resulting change in CMRO2, whether there will be a delay between the start of the apnea and a change in CMRO2, or if there will be a delay for CMRO2 to rise after the event ends. To explore this we zoom into the approximately 15 minutes surrounding the apneaic event and implement a double switch-point analysis.

![ Switch Point]({{ site.baseurl }}/images/post1/Apnea_Detection.png)

We model CMRO2 overtime with a Normal distribution whose mean is dependent upon two switch points.
$CMRO_2 \sim N(\mu_t,\sigma), \mu_t \begin{cases}
    e & \text{if } &t < s_1 \\ 
    m & \text{if} &s_1 < t < s_2 \\
    l & \text{if} &t > s_3 \\
\end{cases}$

The switchpoints are uniformly distributed between either the first time point or the first switch point and the end of the time series. There are three modeled means one prior to the first switchpoint, the second in between the two switchpoints, and the third after the second switchpoint. We then use MCMC fo inference.
$ s_1 \sim Unif(t_1, t_n)$ \\
$s_2 \sim Unif(s_1, s_3)$ \\
$s_3 \sim Unif(t_2, t_n) $ 

The apnea is not explicitly modeled, yet we can see that as soon as the apnea starts CMRO2 decreases right away (from 109.4 to 104.1 micromoles of O2/minute/100g of tissue) but doesn't rebound until about 2 minutes after the end of the apnea.




------
